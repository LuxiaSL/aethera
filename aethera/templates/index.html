{% extends "base.html" %}

{% block content %}
<section class="posts-section homepage-content">
    <div id="posts-container"
         hx-get="/posts?page=1"
         hx-trigger="load"
         hx-swap="innerHTML">
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="/static/js/hover-star.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const postsContainer = document.getElementById('posts-container');
        let currentPage = 1;

        let observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    currentPage++;
                    entry.target.remove();
                    observer.unobserve(entry.target);
                    htmx.ajax('GET', `/posts?page=${currentPage}`, { target: '#posts-container', swap: 'beforeend' });
                }
            });
        }, { threshold: 0.1 });

        document.body.addEventListener('htmx:afterSwap', function(evt) {
            if (evt.detail.target.id === 'posts-container') {
                const sentinels = document.querySelectorAll('.scroll-sentinel');
                if (sentinels && sentinels.length > 0) {
                    observer.observe(sentinels[sentinels.length - 1]);
                }
            }
        });
    });
</script>
{% endblock %}
